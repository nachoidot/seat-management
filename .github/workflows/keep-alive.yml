name: Keep CloudType Server Alive

on:
  schedule:
    # ë§¤ 3ë¶„ë§ˆë‹¤ ì‹¤í–‰ (UTC ê¸°ì¤€) - Vercel Cronê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ
    - cron: '*/3 * * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  ping-server:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Backend Server
        run: |
          echo "ğŸ¤– Starting keep-alive ping..."
          
          # ë°±ì—”ë“œ ì„œë²„ í•‘
          for i in {1..3}; do
            echo "Attempt $i: Pinging backend..."
            if curl -f -s --max-time 30 https://port-0-seat-management-mcdii4ecc60f3aad.sel5.cloudtype.app/api/seats; then
              echo "âœ… Backend is alive!"
              break
            else
              echo "âŒ Backend ping failed, retrying in 10 seconds..."
              sleep 10
            fi
          done
          
      - name: Ping Frontend Server  
        run: |
          echo "ğŸŒ Pinging frontend..."
          
          # í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ í•‘
          for i in {1..2}; do
            echo "Attempt $i: Pinging frontend..."
            if curl -f -s --max-time 20 https://seat-management-el5wgnzgi-jaeho-chois-projects.vercel.app; then
              echo "âœ… Frontend is alive!"
              break
            else
              echo "âŒ Frontend ping failed, retrying in 5 seconds..."
              sleep 5
            fi
          done
          
      - name: Health Check API
        run: |
          echo "ğŸ¥ Testing API endpoints..."
          
          # ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸ ì²´í¬
          curl -f -s --max-time 20 https://port-0-seat-management-mcdii4ecc60f3aad.sel5.cloudtype.app/api/timeslots || echo "Timeslots API might be sleeping"
          
          echo "âœ¨ Keep-alive ping completed at $(date)" 